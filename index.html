<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Vault Tool</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #2c2c2c; color: #e6e6e6; margin: 0; }
h1 { margin-bottom: 12px; font-size: clamp(16px, 4vw, 18px); }
.tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #4b4b4b; }
.tab { padding: 10px 20px; background: #333; border: none; color: #e6e6e6; cursor: pointer; border-radius: 8px 8px 0 0; font-size: clamp(13px, 3.5vw, 14px); }
.tab.active { background: #444; border-bottom: 2px solid #0084ff; }
.tab-content { display: none; }
.tab-content.active { display: block; }
textarea { width:100%; min-height:140px; padding:12px; border-radius:8px; border:1px solid #4b4b4b; background:#333; color:#e6e6e6; font-size: clamp(13px, 3.5vw, 14px); box-sizing:border-box; }
input[type="text"], input[type="number"] { width:100%; padding:10px; border-radius:8px; border:1px solid #4b4b4b; background:#333; color:#e6e6e6; font-size: clamp(13px, 3.5vw, 14px); box-sizing:border-box; margin-bottom: 12px; }
select, button { padding:8px 10px; border-radius:8px; border:1px solid #4b4b4b; background:#444; color:#e6e6e6; font-size: clamp(12px, 3.5vw, 14px); cursor: pointer; }
button:hover { background: #555; }
.controls { display:flex; flex-wrap:wrap; gap:10px; margin:12px 0; align-items:center; }
.output-container { position:relative; margin-top:16px; }
.output-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; min-height:24px; }
.copyBtn { padding:6px 10px; border-radius:6px; background:#555; color:#fff; border:none; cursor:pointer; display:none; }
.char-count { font-size:0.9rem; color:#999; font-weight:bold; }
.char-limit { color:#ff3b3b; font-weight:bold; }
.combo-count { font-size:0.9rem; color:#4a9eff; font-weight:bold; }
.output { background:#1e1e1e; padding:14px; border-radius:10px; font-family:"Courier New", Courier, monospace; font-size: clamp(0.85rem, 2.5vw, 1.05rem); line-height:1.4; white-space:pre-wrap; overflow-x:auto; word-break:break-word; min-height:80px; border:1px solid #4b4b4b; max-height: 500px; overflow-y: auto; }
.underline { text-decoration: underline; }
b { font-weight: bold; }
label { font-size: clamp(13px, 3.5vw, 14px); }
.form-group { margin-bottom: 16px; }
.generate-btn { background: #0084ff; color: white; padding: 10px 20px; font-weight: bold; }
.generate-btn:hover { background: #0073e6; }
@media(max-width:600px){ .output{ font-size: clamp(0.8rem, 2.5vw, 0.95rem); } select,button{ font-size: clamp(12px, 3.5vw, 13px); padding:7px 9px; } }
</style>
</head>
<body>

<h1>Vault Tool</h1>

<div class="tabs">
  <button class="tab active" onclick="switchTab('highlighter')">Highlight & Spacing</button>
  <button class="tab" onclick="switchTab('generator')">Code Generator</button>
</div>

<!-- TAB 1: Difference Highlighter -->
<div id="highlighter" class="tab-content active">
  <textarea id="inputBox" placeholder="Enter number combinations."></textarea>

  <div class="controls">
    <label for="styleOption">Highlight:</label>
    <select id="styleOption">
      <option value="none">None</option>
      <option value="bold">Bold</option>
      <option value="underline">Underline</option>
    </select>

    <label for="spaceOption">Spacing:</label>
    <select id="spaceOption">
      <option value="0">None</option>
      <option value="1">1</option>
      <option value="5">5</option>
      <option value="10">10</option>
      <option value="20">20</option>
    </select>
  </div>

  <div class="output-container">
    <div class="output-header">
      <button class="copyBtn" id="copyBtn">COPY</button>
      <div class="char-count" id="charCount"></div>
    </div>
    <div id="output" class="output"></div>
  </div>
</div>

<!-- TAB 2: Code Generator -->
<div id="generator" class="tab-content">
  <div class="form-group">
    <label for="numbersInput">Numbers in Sequence (comma-separated):</label>
    <input type="text" id="numbersInput" placeholder="e.g. 1, 4, 6, 7">
  </div>

  <div class="form-group">
    <label for="digitAmount">Digit Amount:</label>
    <input type="number" id="digitAmount" min="1" max="10" value="8" placeholder="e.g. 8">
  </div>

  <div class="form-group">
    <label for="startingNumber">Starting Number (leave empty for all):</label>
    <input type="text" id="startingNumber" placeholder="e.g. 1 or leave empty">
  </div>

  <button class="generate-btn" onclick="generateCombinations()">GENERATE</button>

  <div class="output-container">
    <div class="output-header">
      <div class="combo-count" id="comboCount"></div>
      <button class="copyBtn" id="copyBtn2">COPY</button>
    </div>
    <div id="output2" class="output"></div>
  </div>
</div>

<script>
// Tab switching
function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(tabName).classList.add('active');
}

// TAB 1: Difference Highlighter
const inputBox = document.getElementById('inputBox');
const styleOption = document.getElementById('styleOption');
const spaceOption = document.getElementById('spaceOption');
const outputDiv = document.getElementById('output');
const copyBtn = document.getElementById('copyBtn');
const charCount = document.getElementById('charCount');

const MAX_CHARS = 2000;

function sanitizeLine(line){
  return (line||'').replace(/\D+/g,'');
}

function buildOutput(lines, repetitionOption, style){
  const cleaned = lines.map(l=>sanitizeLine(l)).filter(l=>l.length>0);
  if(cleaned.length===0) return {htmlOut:'', plainOut:'', charCount:0};

  const groupSize = parseInt(repetitionOption) || 0;

  const allLines = [];

  cleaned.forEach((line, index)=>{
    const digits = line.split('');
    
    // Compare to previous line (or no comparison for first line)
    const prevLine = index > 0 ? cleaned[index - 1] : null;
    const prevDigits = prevLine ? prevLine.split('') : null;
    
    // Build plain text with Discord-style formatting (used for both display and copy)
    const plainTokens = digits.map((d,i)=>{
      const changed = prevDigits && (d !== prevDigits[i]);
      if(style==='bold' && changed) return '**'+d+'**';
      if(style==='underline' && changed) return '__'+d+'__';
      return d;
    });
    const plainLine = plainTokens.join(' ');

    allLines.push(plainLine);
    
    // Add blank line after every groupSize lines (but not after the last line)
    if(groupSize > 0 && (index + 1) % groupSize === 0 && index < cleaned.length - 1){
      allLines.push('');
    }
  });

  // Trim to fit within MAX_CHARS, removing lines from the end
  let finalLines = [];
  let currentLength = 0;
  
  for(let i = 0; i < allLines.length; i++){
    const lineWithNewline = allLines[i] + (i < allLines.length - 1 ? '\n' : '');
    if(currentLength + lineWithNewline.length <= MAX_CHARS){
      finalLines.push(allLines[i]);
      currentLength += lineWithNewline.length;
    } else {
      break;
    }
  }

  const plainOut = finalLines.join('\n');
  const htmlOut = finalLines.join('<br>');

  return { htmlOut, plainOut, charCount: plainOut.length };
}

function updateOutput(){
  const rawLines = inputBox.value.split(/\r?\n/);
  const style = styleOption.value;
  const repetitionOption = spaceOption.value;

  const { htmlOut, plainOut, charCount: count } = buildOutput(rawLines, repetitionOption, style);
  outputDiv.innerHTML = htmlOut;
  outputDiv.dataset.plain = plainOut;

  // Update character count display
  if(count > 0){
    const isAtLimit = count >= MAX_CHARS;
    charCount.innerHTML = isAtLimit 
      ? `<span class="char-limit">${count} / ${MAX_CHARS} characters (at limit)</span>`
      : `${count} / ${MAX_CHARS} characters`;
    charCount.style.display = 'block';
  } else {
    charCount.style.display = 'none';
  }

  if(htmlOut) copyBtn.style.display = 'inline-block';
  else copyBtn.style.display = 'none';
}

// Live updates on input and option change
inputBox.addEventListener('input', updateOutput);
styleOption.addEventListener('change', updateOutput);
spaceOption.addEventListener('change', updateOutput);

// Copy button
copyBtn.addEventListener('click', ()=>{
  const text = outputDiv.dataset.plain || '';
  navigator.clipboard.writeText(text).then(()=>{
    copyBtn.innerText='COPIED!';
    setTimeout(()=>copyBtn.innerText='COPY',1200);
  });
});

// Initialize
updateOutput();

// TAB 2: Code Generator
const numbersInput = document.getElementById('numbersInput');
const digitAmount = document.getElementById('digitAmount');
const startingNumber = document.getElementById('startingNumber');
const output2 = document.getElementById('output2');
const copyBtn2 = document.getElementById('copyBtn2');
const comboCount = document.getElementById('comboCount');

function generateCombinations() {
  const numbersText = numbersInput.value.trim();
  const digits = digitAmount.value;
  const startNum = startingNumber.value.trim();
  
  if (!numbersText || !digits) {
    alert('Please enter both numbers and digit amount');
    return;
  }
  
  // Parse numbers from input
  const numbers = numbersText.split(',').map(n => n.trim()).filter(n => n !== '');
  const digitCount = parseInt(digits);
  
  if (numbers.length === 0) {
    alert('Please enter valid numbers');
    return;
  }
  
  // Validate starting number if provided
  if (startNum && !numbers.includes(startNum)) {
    alert('Starting number must be one of the numbers in the sequence');
    return;
  }
  
  if (digitCount < numbers.length) {
    alert(`Digit amount must be at least ${numbers.length} to include all numbers`);
    return;
  }
  
  if (digitCount > 10) {
    alert('Digit amount must be 10 or less');
    return;
  }
  
  // Generate all combinations that contain ALL numbers at least once
  const combinations = new Set();
  
  function generate(current) {
    if (current.length === digitCount) {
      // Check if all numbers are present in the combination
      const hasAll = numbers.every(num => current.includes(num));
      if (hasAll) {
        // Check starting number filter if specified
        if (!startNum || current[0] === startNum) {
          combinations.add(current.join(''));
        }
      }
      return;
    }
    
    for (let num of numbers) {
      generate([...current, num]);
    }
  }
  
  generate([]);
  
  // Display results
  const combosArray = Array.from(combinations).sort();
  const outputText = combosArray.join('\n');
  output2.textContent = outputText;
  output2.dataset.plain = outputText;
  
  // Update count
  const startText = startNum ? ` starting with ${startNum}` : '';
  comboCount.textContent = `${combosArray.length} combinations${startText}`;
  comboCount.style.display = 'block';
  
  // Show copy button
  copyBtn2.style.display = 'inline-block';
}

// Copy button for generator
copyBtn2.addEventListener('click', ()=>{
  const text = output2.dataset.plain || '';
  navigator.clipboard.writeText(text).then(()=>{
    copyBtn2.innerText='COPIED!';
    setTimeout(()=>copyBtn2.innerText='COPY',1200);
  });
});
</script>

</body>
</html>
